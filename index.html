<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Trivia Widget</title>
  <style>
    /* ...Your existing styles remain unchanged... */
  </style>
</head>
<body>
  <div id="timer">Revealing answer in 20 seconds...</div>
  <div id="questions-wrapper">
    <div class="question-bg">?</div>
  </div>
  <script>
    // Place your questions JSON file in the same directory and name it "questions.json"
    // Example import: <script src="questions.json"></script> is not allowed, must fetch.

    let selectedQuestion = null;
    let timerInterval = null;

    // Load questions from local JSON file
    async function loadQuestions() {
      const res = await fetch('questions.json');
      return await res.json();
    }

    function showQuestion(qObj) {
      const wrapper = document.getElementById('questions-wrapper');
      // Keep the background ? intact
      const bg = wrapper.querySelector('.question-bg');
      wrapper.innerHTML = '';
      if(bg) wrapper.appendChild(bg);

      const options = qObj.options;
      const answerIndex = qObj.correctIndex;
      selectedQuestion = { answerIndex, options };

      const block = document.createElement('div');
      block.className = 'question-block';
      block.innerHTML = `
        <div class="category-title">${qObj.category}</div>
        <div class="question">${qObj.question}</div>
        <div class="options" id="options">
          ${options.map((opt, i) =>
            `<span class="option" id="opt-${i}">${String.fromCharCode(65 + i)}. ${opt}</span>`
          ).join('')}
        </div>
        <div class="reveal" id="reveal" style="display:none;">
          Answer: <span class="correct">${String.fromCharCode(65 + answerIndex)}. ${options[answerIndex]}</span>
        </div>
      `;
      wrapper.appendChild(block);
      // Keep background question mark at the back
      if (!bg) {
        const bgDiv = document.createElement('div');
        bgDiv.className = 'question-bg';
        bgDiv.innerText = '?';
        wrapper.insertBefore(bgDiv, wrapper.firstChild);
      }
    }

    function revealAnswer() {
      if (!selectedQuestion) return;
      document.getElementById('reveal').style.display = 'block';
      document.getElementById(`opt-${selectedQuestion.answerIndex}`).classList.add('correct');
      document.getElementById('timer').innerText = 'Answer revealed!';
      if (timerInterval) clearInterval(timerInterval);
    }

    function startTimer(duration) {
      let timer = duration;
      const timerLabel = document.getElementById('timer');
      timerLabel.textContent = `Revealing answer in ${timer} second${timer !== 1 ? 's' : ''}...`;
      timerInterval = setInterval(function () {
        timer--;
        if (timer > 0) {
          timerLabel.textContent = `Revealing answer in ${timer} second${timer !== 1 ? 's' : ''}...`;
        } else {
          clearInterval(timerInterval);
          timerLabel.textContent = `Answer revealed!`;
        }
      }, 1000);
    }

    (async () => {
      // 1. Load all questions from JSON
      const questions = await loadQuestions();
      // 2. Pick a random question
      const randIdx = Math.floor(Math.random() * questions.length);
      const randQuestion = questions[randIdx];
      // 3. Show the question
      showQuestion(randQuestion);
      // 4. Start timer and reveal after 20s
      startTimer(20);
      setTimeout(revealAnswer, 20000);
    })();
  </script>
</body>
</html>